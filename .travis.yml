env:
  global:
    - VERSION=v0.1
    - FLASK_APP=app
    - FLASK_ENV=development
    - secure: G0UkL34dAV4VEWeFJmi95DMdKQIfMkDuGPf4pQ28nQJctzQuIW5B9So2WJKGv2/4+0yel4oxfquKk7AgjJ5vGJoSvdlN5BU0hzQCsHuVQRjLJHfxjr/ChAgIhV9jaoPJn5ecYeEwRhH7yXvzHkU0GZu6wy1XXyIZ8NN7fsDLgdytKoFoPSYhKNi3ntHX68BXkepXkFdqLZ00pCQHe6mmwGryWb0g2ryur0DQNe/VeRwD9qxcQcEksnzPAlwZYJPGPjB7qKqfFKS72tD5FvrJiI1vW3SCvGcdh+MANEQ/vqjEyPT+MbsJY5oMkzJGowdAgb+taseby2WlH1IWpJV9xmp4YXc0sNQWk2KUlC0fDbz2iXv5efmpgBlMFXddXVsFXzvqL2hzcmdVmIp1D937+EUL6H4F83X1HBUDEnA10ks/22tHlR300nirPWskZezLO2QJnQjxEjI6iF66+AlAEWRhFSuUAX3JOJrP+GhPqWReUXDysGPQ3AyVef1a2wIT6oUY/fcqfWGPuTARxGEg0gWWGD/q0tlHEbyqmocX5DgbjZ0fecEt5Y9k6Gyztp3Pqb91mLd1ZNZJUDtz6buqApd/RezdepvkccuPP2vexO3oLcinlHY+SPBsPV9hNOFFuHYgmc266JfMzYgxEQuujm93MXcnU3PwfdhEhIIsZa0=
    - secure: lqZcdYc+v7glkDRV19vVdnIDuiKKniO0RwULP0iw0BGsLk8gvaSnzOQgZP8e73aLMKdJmbIY9OnXTeCXO2J9P0u338ydWwN824wSZPoxGUSQbf3jnk9SB8hrL6LLQjeV/vpejvLR0n+jqk3Lcg1nCTQKZvkriX8h8ZwY5GrmKodewBe629UCoTVJkZuRf6BewRna0D0xr2lzIeSKSBZfmMJNr0Sk91ovuw7oAknN05Dl3WYUZi+HT77Z4SIfqZwNUe0ycTrV2pMm5VqDxjUSB4zhtt1yaHfv9g3jrD6xq9iXuoIySraMY4nN6+n+tU6v98sYhImhyDTy91MnTs3nP/vm7P8YYPl26/Khe5tA+KgzEtRNUtd46EFJDTV0xrUX38XSiN8kamy3033zcKvjMcZa1fW3KfmFZt9fEm/cQzU6qq+aI7GWMcYyXwMLpyHLsQQ8GP2DhOrrCoCD5uOHuMi8zHmT/ERIGXkiso/ntZWmev9aujpP8XsSbbHA6vN/qIiADAKhFLKaePuzJJis6bA+CdwarTDnywq0M5M7p6BTAXvH8A+vBgKGrCpdIjSVlP3y/3bGs7dTuVGONPxjXf5GxXxS8wwDuxwh1tqezh9MVY05k7XRq2hhJf54e43dROVD2X//9spjGC9q4E7bPpBJQwBqrT/p1N7z+JZ4qDo=
    - secure: 2BMPPMWBeHPaIhoS17oZ7a+sLoDyskRDYAjbLHj6DfTvhvMepCsuGVjgiAkt3LoNOabc4q5pZqg0Msu73dcKBYtpklEJ4gfc9t9q9yHa2PaRz6xHp3uj1XDz1fWij3jPg1lVF6Z+7CdNXPYcNohAxKYOOzEeBRuJHZr94OItjUoB2nySGkv4NEJ/5oZz+ubjwfN90GsYf3CXu7v7PMkNwBtuJoO2aXW57HieLNZHpjSXTCvz/mrCjysmn97tZVeWj8Thp9b4AFBfxSyzDuz+9uB6zARzCg0nUqiifgoxvkilLx/k5Q7UyXmyjI8tT9re8z7uOaj6Z4AfRnYYuWLXar+ABFgwdLRgFOomG8gprG/SxYKUoc9uifjc0PC94UqdprnIpyI8S7/n8hk7t8smovhVnk2SrlOIsAg+VKW7DC6k2c2V/EmDObkKNBdnLqTj6reixVAfrNEa/j1oK4CNT3WwXfnZyEoD7Zfj2007K9cWvWYuu0PdEqL0njcpFl4SOqomms6BwTb6S/8T+Erhg00ZBSoeWmtd2I1m+tcwgm1kXfi6LlYJ57e0aJq8A0nXflEHUEOqiNvoksM2wkinBIZInb+9BnFk6gNLwGQbYHx0CtptFuk0A/ouAPYOf0ZdX7HMOfsLeBbNJFEf//Cm87B1CL8rpU9lJHNlsP2xgKI=

services:
- docker

script:
- docker build --target production --tag todo-app:$VERSION .
- docker build --target test --tag todo-app-test:$VERSION .
- docker images
- docker run --rm -e FLASK_APP=$FLASK_APP -e FLASK_ENV=$FLASK_ENV -e TRELLO_BASE_URL=$TRELLO_BASE_URL -e TRELLO_KEY=$TRELLO_KEY -e TRELLO_TOKEN=$TRELLO_TOKEN todo-app-test:$VERSION -v tests
